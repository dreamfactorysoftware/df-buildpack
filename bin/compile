#!/bin/sh
set -e

echo "-----> Cloning DreamFactory source code"
git clone -b develop https://github.com/dreamfactorysoftware/dreamfactory.git $BUILD_DIR

echo "-----> Checking if database/seeds exists"
ls -la $BUILD_DIR/database
ls -la $BUILD_DIR/database/seeds || echo "X database/seeds/ is missing!"

cd $BUILD_DIR

echo "-----> Installing Composer"
curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

echo "-----> Running Composer Install"
composer install --no-dev --ignore-platform-reqs --optimize-autoloader

echo "-----> Running database migrations"
php artisan migrate --force

echo "-----> Setting up Nginx and PHP-FPM"
mkdir -p $BUILD_DIR/nginx
mkdir -p $BUILD_DIR/php-fpm

